<html>
<head>
  <title>Java 并发专题 ： Timer的缺陷 用ScheduledExecutorService替代</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303502 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="781"/>
<h1>Java 并发专题 ： Timer的缺陷 用ScheduledExecutorService替代</h1>

<div>
<span><div><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">1、Timer管理延时任务的缺陷</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">a、以前在项目中也经常使用定时器，比如每隔一段时间清理项目中的一些垃圾文件，每个一段时间进行数据清洗；然而Timer是存在一些缺陷的，因为Timer在执行定时任务时只会创建一个线程，所以如果存在多个任务，且任务时间过长，超过了两个任务的间隔时间，会发生一些缺陷：下面看例子：</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">Timer的源码：</p><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> Timer {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 130, 0); background-color: inherit;">/**</span> </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     * The timer task queue.  This data structure is shared with the timer</span> </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     * thread.  The timer produces tasks, via its various schedule calls,</span> </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     * and the timer thread consumes, executing timer tasks as appropriate,</span> </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     * and removing them from the queue when they're obsolete.</span> </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     */</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> TaskQueue queue = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TaskQueue();  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 130, 0); background-color: inherit;">/**</span> </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     * The timer thread.</span> </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">     */</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> TimerThread thread = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerThread(queue);  </span></span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">TimerThread是Thread的子类，可以看出内部只有一个线程。下面看个例子:</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.zhy.concurrency.timer;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.Timer;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.TimerTask;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> TimerTest  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">{  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">long</span><span style="background-color: inherit;"> start;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> main(String[] args) </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">throws</span><span style="background-color: inherit;"> Exception  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        TimerTask task1 = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                System.out.println(<span style="color: blue; background-color: inherit;">&quot;task1 invoked ! &quot;</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                        + (System.currentTimeMillis() - start));  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">try</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                    Thread.sleep(<span style="color: rgb(192, 0, 0); background-color: inherit;">3000</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                } <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">catch</span><span style="background-color: inherit;"> (InterruptedException e)  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                    e.printStackTrace();  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        };  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        TimerTask task2 = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                System.out.println(<span style="color: blue; background-color: inherit;">&quot;task2 invoked ! &quot;</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                        + (System.currentTimeMillis() - start));  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        };  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        Timer timer = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Timer();  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        start = System.currentTimeMillis();  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        timer.schedule(task1, <span style="color: rgb(192, 0, 0); background-color: inherit;">1000</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        timer.schedule(task2, <span style="color: rgb(192, 0, 0); background-color: inherit;">3000</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">}  </span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">定义了两个任务，预计是第一个任务1s后执行，第二个任务3s后执行，但是看运行结果：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="background-color: inherit;">task1 invoked ! </span><span style="color: rgb(192, 0, 0); background-color: inherit;">1000</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">task2 invoked ! <span style="color: rgb(192, 0, 0); background-color: inherit;">4000</span><span style="background-color: inherit;">  </span></span></li></ol></div><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">task2实际上是4后才执行，正因为Timer内部是一个线程，而任务1所需的时间超过了两个任务间的间隔导致。下面使用ScheduledThreadPool解决这个问题：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.zhy.concurrency.timer;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.TimerTask;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.Executors;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.ScheduledExecutorService;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.TimeUnit;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> ScheduledThreadPoolExecutorTest  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">{  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">long</span><span style="background-color: inherit;"> start;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> main(String[] args)  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 130, 0); background-color: inherit;">/**</span> </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">         * 使用工厂方法初始化一个ScheduledThreadPool</span> </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">         */</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        ScheduledExecutorService newScheduledThreadPool = Executors  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                .newScheduledThreadPool(<span style="color: rgb(192, 0, 0); background-color: inherit;">2</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        TimerTask task1 = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">try</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                    System.out.println(<span style="color: blue; background-color: inherit;">&quot;task1 invoked ! &quot;</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                            + (System.currentTimeMillis() - start));  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                    Thread.sleep(<span style="color: rgb(192, 0, 0); background-color: inherit;">3000</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                } <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">catch</span><span style="background-color: inherit;"> (Exception e)  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                    e.printStackTrace();  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        };  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        TimerTask task2 = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                System.out.println(<span style="color: blue; background-color: inherit;">&quot;task2 invoked ! &quot;</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                        + (System.currentTimeMillis() - start));  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        };  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        start = System.currentTimeMillis();  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        newScheduledThreadPool.schedule(task1, <span style="color: rgb(192, 0, 0); background-color: inherit;">1000</span><span style="background-color: inherit;">, TimeUnit.MILLISECONDS);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        newScheduledThreadPool.schedule(task2, <span style="color: rgb(192, 0, 0); background-color: inherit;">3000</span><span style="background-color: inherit;">, TimeUnit.MILLISECONDS);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">}  </span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">输出结果：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="background-color: inherit;">task1 invoked ! </span><span style="color: rgb(192, 0, 0); background-color: inherit;">1001</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">task2 invoked ! <span style="color: rgb(192, 0, 0); background-color: inherit;">3001</span><span style="background-color: inherit;">  </span></span></li></ol></div><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">符合我们的预期结果。因为ScheduledThreadPool内部是个线程池，所以可以支持多个任务并发执行。</span><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">2、Timer当任务抛出异常时的缺陷</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">如果TimerTask抛出RuntimeException，Timer会停止所有任务的运行：</p><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.zhy.concurrency.timer;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.Date;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.Timer;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.TimerTask;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> ScheduledThreadPoolDemo01  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">{  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> main(String[] args) </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">throws</span><span style="background-color: inherit;"> InterruptedException  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> TimerTask task1 = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">throw</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> RuntimeException();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        };  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> TimerTask task2 = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">                System.out.println(<span style="color: blue; background-color: inherit;">&quot;task2 invoked!&quot;</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        };  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">          </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        Timer timer = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Timer();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        timer.schedule(task1, <span style="color: rgb(192, 0, 0); background-color: inherit;">100</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        timer.scheduleAtFixedRate(task2, <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Date(), </span><span style="color: rgb(192, 0, 0); background-color: inherit;">1000</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">          </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">}  </span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">上面有两个任务，任务1抛出一个运行时的异常，任务2周期性的执行某个操作，输出结果：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="background-color: inherit;">task2 invoked!  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">Exception in thread <span style="color: blue; background-color: inherit;">&quot;Timer-0&quot;</span><span style="background-color: inherit;"> java.lang.RuntimeException  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    at com.zhy.concurrency.timer.ScheduledThreadPoolDemo01$<span style="color: rgb(192, 0, 0); background-color: inherit;">1</span><span style="background-color: inherit;">.run(ScheduledThreadPoolDemo01.java:</span><span style="color: rgb(192, 0, 0); background-color: inherit;">24</span><span style="background-color: inherit;">)  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    at java.util.TimerThread.mainLoop(Timer.java:<span style="color: rgb(192, 0, 0); background-color: inherit;">512</span><span style="background-color: inherit;">)  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    at java.util.TimerThread.run(Timer.java:<span style="color: rgb(192, 0, 0); background-color: inherit;">462</span><span style="background-color: inherit;">)  </span></span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">由于任务1的一次，任务2也停止运行了。。。下面使用ScheduledExecutorService解决这个问题：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.zhy.concurrency.timer;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.Date;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.Timer;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.TimerTask;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.Executors;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.ScheduledExecutorService;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> java.util.concurrent.TimeUnit;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> ScheduledThreadPoolDemo01  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">{  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> main(String[] args) </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">throws</span><span style="background-color: inherit;"> InterruptedException  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    {  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> TimerTask task1 = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">throw</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> RuntimeException();  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        };  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> TimerTask task2 = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> TimerTask()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">            <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> run()  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            {  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">                System.out.println(<span style="color: blue; background-color: inherit;">&quot;task2 invoked!&quot;</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">            }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        };  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">          </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        ScheduledExecutorService pool = Executors.newScheduledThreadPool(<span style="color: rgb(192, 0, 0); background-color: inherit;">1</span><span style="background-color: inherit;">);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        pool.schedule(task1, <span style="color: rgb(192, 0, 0); background-color: inherit;">100</span><span style="background-color: inherit;">, TimeUnit.MILLISECONDS);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        pool.scheduleAtFixedRate(task2, <span style="color: rgb(192, 0, 0); background-color: inherit;">0</span><span style="background-color: inherit;"> , </span><span style="color: rgb(192, 0, 0); background-color: inherit;">1000</span><span style="background-color: inherit;">, TimeUnit.MILLISECONDS);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">}  </span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">代码基本一致，但是ScheduledExecutorService可以保证，task1出现异常时，不影响task2的运行：</span><div style="word-wrap: break-word; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Consolas, 'Courier New', Courier, mono, serif; color: rgb(85, 85, 85); margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">view plain</a> <a href="http://blog.csdn.net/lmj623565791/article/details/27109467#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="background-color: inherit;">task2 invoked!  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">task2 invoked!  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">task2 invoked!  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">task2 invoked!  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">task2 invoked!&lt;span style=<span style="color: blue; background-color: inherit;">&quot;font-family: Arial, Helvetica, sans-serif;&quot;</span><span style="background-color: inherit;">&gt;...&lt;/span&gt;  </span></span></li></ol></div><br style="color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><span style="font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">3、Timer执行周期任务时依赖系统时间</span><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">Timer执行周期任务时依赖系统时间，如果当前系统时间发生变化会出现一些执行上的变化，ScheduledExecutorService基于时间的延迟，不会由于系统时间的改变发生执行变化。</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);"><br/></p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);">上述，基本说明了在以后的开发中尽可能使用ScheduledExecutorService(JDK1.5以后)替代Timer。</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; font-size: 15px; background-color: rgb(255, 255, 255);"><br/></p><div style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(85, 85, 85); font-family: 'microsoft yahei'; background-color: rgb(255, 255, 255); font-size: 15px;"><div>好了，如果博客中存在错误，请留言指出~</div></div></div></span>
</div></body></html> 