<html>
<head>
  <title>使用LargeHeap</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303502 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="457"/>
<h1>使用LargeHeap</h1>

<div>
<span><div><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-family: 'Source Sans Pro', sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">via：<a href="http://outofmemory.cn/android/android-largeHeap" style="box-sizing: border-box; color: rgb(214, 80, 80); text-decoration: none; transition: all 0.3s ease-in-out; -webkit-transition: all 0.3s ease-in-out; background-color: transparent;" target="_blank">http://outofmemory.cn/android/android-largeHeap</a></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-family: 'Source Sans Pro', sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-family: 'Source Sans Pro', sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">在日常的Android开发中，我们必然遇到过OutOfMemoryError这样的崩溃，产生的原因无外乎两点，一是内存过小不够用，二是程序设计有误，导致不能释放内存，其中后者情况较多。在解决这个问题时，我们亦或多或少听到android:largeHeap，然而这个概念又是什么呢，它该如何使用，存在哪些问题呢。本文讲比较全面介绍Android中的largeHeap帮助各位全面深入了解这个概念。</p><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">磨刀不误砍柴工<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">为了便于理解，先简单介绍一些和文章相关的基础概念。</p><ul style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><li style="box-sizing: border-box;">通常，一个Android程序在运行时会启动一个Dalvik虚拟机（暂不讨论ART模式）</li><li style="box-sizing: border-box;">虚拟机的运行时内存一般由堆和栈两大部分构成。</li><li style="box-sizing: border-box;">栈是存储方法调用的一片内存数据区。</li><li style="box-sizing: border-box;">堆内存占据了虚拟机的大部分内存空间，程序执行时产生的对象就分配在堆内存上。</li><li style="box-sizing: border-box;">如果是堆内存没有可用的空间存储生成的对象，JVM会抛出java.lang.OutOfMemoryError。</li></ul><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">如若具体了解堆和栈，请参考文章 <a href="http://ju.outofmemory.cn/entry/103244" style="box-sizing: border-box; color: rgb(214, 80, 80); text-decoration: none; transition: all 0.3s ease-in-out; -webkit-transition: all 0.3s ease-in-out; background-color: transparent;">Java中的堆和栈的区别 </a>和 <a href="http://ju.outofmemory.cn/entry/106957" style="box-sizing: border-box; color: rgb(214, 80, 80); text-decoration: none; transition: all 0.3s ease-in-out; -webkit-transition: all 0.3s ease-in-out; background-color: transparent;">JVM运行时的数据区</a></p><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">largeHeap介绍<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">一个应用如果使用了largeHeap，会请求系统为Dalvik虚拟机分配更大的内存空间。使用起来也很方便，只需在manifest文件application节点加入 <strong style="box-sizing: border-box; font-weight: 600;">android:largeHeap=“true” </strong>即可。</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; display: block; padding: 9.5px; margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">&lt;application</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:icon</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;@drawable/icon&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:allowBackup</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;false&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:label</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;@string/app_name&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:debuggable</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;true&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:theme</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;@android:style/Theme.Black&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(255, 0, 0);">android:largeHeap</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 255);">&quot;true&quot;</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> </span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">&gt;</span></pre><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">largeHeap有多大<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">在Android中，有如下两个方法可以帮助我们查看当前内存大小</p><ul style="box-sizing: border-box; margin-top: 0px; margin-bottom: 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><li style="box-sizing: border-box;">ActivityManager.getMemoryClass()获得内用正常情况下内存的大小</li><li style="box-sizing: border-box;">ActivityManager.getLargeMemoryClass()可以获得开启largeHeap最大的内存大小</li></ul><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">然而largeHeap这个最大值是如何决定的呢？想要了解这个问题，我们就需要看一下Android系统中的一个文件。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">这个文件路径是 /system/build.prop ，由于文件比较大，这里我们只截取关于dalvik内存的配置信息，如下。</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; display: block; padding: 9.5px; margin: 0px 0px 10px; word-break: break-all; word-wrap: break-word; color: rgb(51, 51, 51); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="box-sizing: border-box; font-family: Arial, 宋体;">dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heapstartsize</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">8m</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heapgrowthlimit</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">192m</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heapsize</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">512m</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heaptargetutilization</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">0.75</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heapminfree</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">2m</span><span style="box-sizing: border-box; font-family: Arial, 宋体;"> dalvik</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">vm</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">.</span><span style="box-sizing: border-box; font-family: Arial, 宋体;">heapmaxfree</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(0, 0, 0);">=</span><span style="box-sizing: border-box; font-family: Arial, 宋体; color: rgb(128, 0, 0);">8m</span></pre><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">上面有诸多配置，但从字面意思也不难理解，为了正确理解，有必要逐一解释一下。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapstartsize=8m</strong></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">相当于虚拟机的 -Xms配置，该项用来设置堆内存的初始大小。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapgrowthlimit=192m</strong></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">相当于虚拟机的 -XX:HeapGrowthLimit配置，该项用来设置一个标准的应用的最大堆内存大小。一个标准的应用就是没有使用android:largeHeap的应用。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapsize=512m</strong></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">相当于虚拟机的 -Xmx配置，该项设置了使用android:largeHeap的应用的最大堆内存大小。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heaptargetutilization=0.75</strong></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">相当于虚拟机的 -XX:HeapTargetUtilization,该项用来设置当前理想的堆内存利用率。其取值位于0与1之间。当GC进行完垃圾回收之后，Dalvik的堆内存会进行相应的调整，通常结果是当前存活的对象的大小与堆内存大小做除法，得到的值为这个选项的设置，即这里的0.75。注意，这只是一个参考值， <a href="http://grepcode.com/file/repo1.maven.org/maven2/org.robovm/robovm-rt/1.0.0/dalvik/system/VMRuntime.java#VMRuntime.setTargetHeapUtilization%28float%29" style="box-sizing: border-box; color: rgb(214, 80, 80); text-decoration: none; transition: all 0.3s ease-in-out; -webkit-transition: all 0.3s ease-in-out; background-color: transparent;">Dalvik虚拟机也可以忽略此设置 </a>。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);"><strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapminfree=2m </strong>与 <strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapmaxfree=8m</strong></p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">dalvik.vm.heapminfree对应的是-XX:HeapMinFree配置，用来设置单次堆内存调整的最小值。<strong style="box-sizing: border-box; font-weight: 600;">dalvik.vm.heapmaxfree </strong>对应的是-XX:HeapMaxFree配置，用来设置单次堆内存调整的最大值。通常情况下，还需要结合上面的 -XX:HeapTargetUtilization的值，才能确定内存调整时，需要调整的大小。</p><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">largeHeap需要权限么<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">为何有此疑问呢？ 原因是这样的。 首先一个设备的内存是固定的，当我们使用了largeHeap之后就可以使我们的程序内存增加，但这部分增加的内存有可能是源自被系统杀掉的后台程序。所以，使用largeHeap理论上是有可能杀掉其他的程序的。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">然而，结果就是不需要权限，Google在一开始就是这样，只需要简单在Application元素上加入android:largeHeap=“true”就能正常使用。</p><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">largeHeap对GC的影响<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">拥有了更多的内存，是不是就意味着要花更多的时间遍历对象垃圾回收呢？其实不然。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">首先largeHeap自Android 4.0开始支持，而并发的垃圾回收方式从Android 2.3开始引入。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">在引入并发垃圾回收之前，系统采用了Stop-the-World回收方式，进行一次垃圾回收通常消耗几百毫秒，这是很影响交互和响应的。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">引入并发垃圾回收之后,在GC开始和结束的阶段会有短暂的暂停时间，通常在10毫秒以内。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">因此在支持largeHeap的系统上都采用了并发垃圾回收，GC的Pause Time不会很长，对交互响应影响甚微。</p><h2 style="box-sizing: border-box; font-family: 微软雅黑, 黑体; font-weight: 600; color: rgb(68, 63, 63); margin: 10px 0px 24px; font-size: 42px; font-style: normal; font-variant: normal; font-stretch: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">慎用largeHeap<br style="box-sizing: border-box;"/></h2><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">对于largeHeap的使用，我们该持有的谨慎的态度，largeHeap可以使用，但是要谨慎。</p><p style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255);">对于本身对内存要求过大的图片或者视频应用，我们可以使用largeHeap。</p><div style="box-sizing: border-box; margin: 0px 0px 10px; color: rgb(118, 118, 118); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial, 宋体; background-color: rgb(255, 255, 255); font-size: 14px;"><div>除上面的情况，如果仅仅是为了解决OutOfMemoryError这样的问题，而尝试使用largeHeap分配更大内存的这种指标不治本的方法不可取。对待这样的OOM问题，建议阅读以下几篇文章，了解Android中内存泄露和垃圾回收，从代码上去查找问题，从根本上解决问题。</div></div></div></span>
</div></body></html> 