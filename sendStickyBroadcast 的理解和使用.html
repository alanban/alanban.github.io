<html>
<head>
  <title>sendStickyBroadcast 的理解和使用</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303502 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="761"/>
<h1>sendStickyBroadcast 的理解和使用</h1>

<div>
<span><div><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; background-color: rgb(255, 255, 255);">sendStickyBroadcast的特别之处，它将发出的广播保存起来，一旦发现有人注册这条广播，则立即能接收到。</span></p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; background-color: rgb(255, 255, 255);">via:<a href="http://blog.csdn.net/woaieillen/article/details/7376391" target="_blank">http://blog.csdn.net/woaieillen/article/details/7376391</a></span></p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(0, 0, 0); font-family: 'sans serif', tahoma, verdana, helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; background-color: rgb(255, 255, 255);">要知道区别首先需要看一下Android Developers Reference， 它可是我们最好的老师了，sendBroadcast 大家应该都会用了我就不赘述了，下面来看看sendStickyBroadcast</p><p style="word-wrap: break-word; margin: 5px 0px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; background-color: rgb(255, 255, 255);">google官方的解释是：</p><div style="word-wrap: break-word; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><p style="word-wrap: break-word; margin: 5px 0px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;">Perform a <a href="file:///F:/android-sdk-windows/docs/reference/android/content/Context.html#sendBroadcast(android.content.Intent)">sendBroadcast(Intent)</a> that is &quot;sticky,&quot; meaning the Intent you are sending stays around after the broadcast is complete, so that others can quickly retrieve that data through the return value of<a href="file:///F:/android-sdk-windows/docs/reference/android/content/Context.html#registerReceiver(android.content.BroadcastReceiver, android.content.IntentFilter)">registerReceiver(BroadcastReceiver, IntentFilter)</a>. In all other ways, this behaves the same as<a href="file:///F:/android-sdk-windows/docs/reference/android/content/Context.html#sendBroadcast(android.content.Intent)">sendBroadcast(Intent)</a>.</span></span></span></p><p style="word-wrap: break-word; margin: 5px 0px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;">You must hold the <a href="file:///F:/android-sdk-windows/docs/reference/android/Manifest.permission.html#BROADCAST_STICKY">BROADCAST_STICKY</a> permission in order to use this API. If you do not hold that permission,<a href="file:///F:/android-sdk-windows/docs/reference/java/lang/SecurityException.html">SecurityException</a> will be thrown.</span></span></span></p><p style="word-wrap: break-word; margin: 5px 0px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;">大概的意思是说： 发出的广播会一直滞留（等待），以便有人注册这则广播消息后能尽快的收到这条广播。其他功能与sendBroadcast相同。但是使用sendStickyBroadcast 发送广播需要获得<a href="file:///F:/android-sdk-windows/docs/reference/android/Manifest.permission.html#BROADCAST_STICKY">BROADCAST_STICKY</a> permission，如果没有这个permission则会抛出异常。</span></span></span></p><p style="word-wrap: break-word; margin: 5px 0px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;"> </span></span></span></p><p style="word-wrap: break-word; margin: 5px 0px;"><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;">这个解释看了后似懂非懂的，于是就写了个例子试了下，下面把代码贴出了，希望能还大家一起讨论</span></span></span></p><div style="word-wrap: break-word; font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px; margin: 18px 0px !important; background-color: rgb(231, 229, 220);"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px 8px 10px 10px; font-size: 9px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; color: silver; background-color: rgb(248, 248, 248);"><b>[java]</b> <a href="http://blog.csdn.net/woaieillen/article/details/7376391#">view plain</a> <a href="http://blog.csdn.net/woaieillen/article/details/7376391#">copy</a></div></div><ol style="color: rgb(92, 92, 92); background-color: rgb(255, 255, 255);"><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.android.test;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.app.Activity;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.Context;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.Intent;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.os.Bundle;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.view.View;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.view.View.OnClickListener;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.widget.Button;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> StickyBroadcastTest </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">extends</span><span style="background-color: inherit;"> Activity {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> Button mSendBroadcast;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> Button mSendStickyBroadcast;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> Button mNextActivity;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> Context mContext;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">int</span><span style="background-color: inherit;"> mStickyBrcCount;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 130, 0); background-color: inherit;">/** Called when the activity is first created. */</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onCreate(Bundle savedInstanceState) {  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">super</span><span style="background-color: inherit;">.onCreate(savedInstanceState);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        setContentView(R.layout.main);  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        mContext = getApplicationContext();  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        mSendBroadcast = (Button)findViewById(R.id.broadcast);  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        mSendStickyBroadcast = (Button)findViewById(R.id.stickybroadcast);  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        mNextActivity = (Button)findViewById(R.id.next_activity);  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        mSendBroadcast.setOnClickListener(<span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> OnClickListener() {  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">     </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onClick(View v) {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">      </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    Intent intent = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Intent(</span><span style="color: blue; background-color: inherit;">&quot;com.android.action.broadcast&quot;</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    mContext.sendBroadcast(intent);  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  });  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">          </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        mSendStickyBroadcast.setOnClickListener(<span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> OnClickListener() {  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">     </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onClick(View v) {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    mStickyBrcCount++;  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    Intent intent = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Intent(</span><span style="color: blue; background-color: inherit;">&quot;com.android.action.sticky.broadcast&quot;</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    intent.putExtra(<span style="color: blue; background-color: inherit;">&quot;sent_count&quot;</span><span style="background-color: inherit;">, mStickyBrcCount);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    mContext.sendStickyBroadcast(intent);  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">      </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  });    </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        mNextActivity.setOnClickListener(<span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> OnClickListener() {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">     </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onClick(View v) {  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    Intent intent = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> Intent(StickyBroadcastTest.</span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">this</span><span style="background-color: inherit;">, MyReceiverActivity.</span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    startActivity(intent);     </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">      </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  });  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    }  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">protected</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onResume() {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 130, 0); background-color: inherit;">// TODO Auto-generated method stub</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">super</span><span style="background-color: inherit;">.onResume();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  mStickyBrcCount = <span style="color: rgb(192, 0, 0); background-color: inherit;">0</span><span style="background-color: inherit;">;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">     </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">}  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 130, 0); background-color: inherit;">//MyReceiverActivity </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">package</span><span style="background-color: inherit;"> com.android.test;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.app.Activity;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.BroadcastReceiver;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.Context;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.Intent;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.content.IntentFilter;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.os.Bundle;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">import</span><span style="background-color: inherit;"> android.util.Log;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">class</span><span style="background-color: inherit;"> MyReceiverActivity </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">extends</span><span style="background-color: inherit;"> Activity {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> IntentFilter mIntentFilter;  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">static</span><span style="background-color: inherit;"> String TAG = </span><span style="color: blue; background-color: inherit;">&quot;MyReceiverActivity&quot;</span><span style="background-color: inherit;">;  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 130, 0); background-color: inherit;">/** Called when the activity is first created. */</span><span style="background-color: inherit;">  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">    <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onCreate(Bundle savedInstanceState) {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">super</span><span style="background-color: inherit;">.onCreate(savedInstanceState);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        setContentView(R.layout.broadcast_receiver);  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">          </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        mIntentFilter = <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> IntentFilter();     </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">        mIntentFilter.addAction(<span style="color: blue; background-color: inherit;">&quot;com.android.action.broadcast&quot;</span><span style="background-color: inherit;">);     </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">        mIntentFilter.addAction(<span style="color: blue; background-color: inherit;">&quot;com.android.action.sticky.broadcast&quot;</span><span style="background-color: inherit;">);     </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">    }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">       </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">private</span><span style="background-color: inherit;"> BroadcastReceiver  mReceiver = </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">new</span><span style="background-color: inherit;"> BroadcastReceiver () {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">public</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onReceive(Context context, Intent intent) {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">final</span><span style="background-color: inherit;"> String action = intent.getAction();  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">int</span><span style="background-color: inherit;"> count = intent.getIntExtra(</span><span style="color: blue; background-color: inherit;">&quot;sent_count&quot;</span><span style="background-color: inherit;">, -</span><span style="color: rgb(192, 0, 0); background-color: inherit;">1</span><span style="background-color: inherit;">);  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   Log.d(TAG, <span style="color: blue; background-color: inherit;">&quot;action = &quot;</span><span style="background-color: inherit;"> + action + </span><span style="color: blue; background-color: inherit;">&quot;and count = &quot;</span><span style="background-color: inherit;"> + count);  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">     </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">   <span style="color: rgb(0, 130, 0); background-color: inherit;">//context.removeStickyBroadcast(intent);</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> };  </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">protected</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onPause() {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 130, 0); background-color: inherit;">// TODO Auto-generated method stub</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">super</span><span style="background-color: inherit;">.onPause();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  unregisterReceiver(mReceiver);     </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> }   </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;"> <span style="color: rgb(100, 100, 100); background-color: inherit;">@Override</span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">protected</span><span style="background-color: inherit;"> </span><span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">void</span><span style="background-color: inherit;"> onResume() {  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 130, 0); background-color: inherit;">// TODO Auto-generated method stub  </span><span style="background-color: inherit;">  </span></span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">  <span style="color: rgb(0, 102, 153); font-weight: bold; background-color: inherit;">super</span><span style="background-color: inherit;">.onResume();  </span></span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">  registerReceiver(mReceiver, mIntentFilter);   </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;"> }  </span></li><li style="background-color: rgb(248, 248, 248);"><span style="color: black; background-color: inherit;">     </span></li><li style="color: inherit;"><span style="color: black; background-color: inherit;">}  </span></li></ol></div><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;"><br/></span></span></span><div style="word-wrap: break-word; margin: 5px 0px;"><div><span style="color: rgb(51, 51, 51);"><span style="font-size: 14px;"><span style="font-family: Arial;">运行结果如图：</span></span></span></div><div><img height="317" src="http://hi.csdn.net/attachment/201110/20/0_1319096270ai9s.gif" style="border: 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);" width="913"></img></div><div><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">首先点击next Activity从代码中可以看到receiver已经注册，但Log无输出，这是当然的了~~~因为没有广播发出自然就不会有人响应了。</p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">按back后退到上图</p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">下面分别点击send broadcast 和 send stickybroadcast按钮，随便点击几次，此时对应的receiver并没有注册，所以是不会有人响应这两条广播的。然后点击next activity，当打开新的activity后对应的receiver被注册，此时从日志中就能看出已经收到了send stickybroadcast发出的广播，但没有send broadcast发出的广播。这就是sendStickyBroadcast的特别之处，它将发出的广播保存起来，一旦发现有人注册这条广播，则立即能接收到。</p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">日志打印为： action = com.android.action.sticky.broadcastand count = 4</p><p style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px;">从上面的日志信息可以看出sendStickyBroadcast只保留最后一条广播，并且一直保留下去，这样即使已经处理了这条广播但当再一次注册这条广播后依然可以收到它。</p><div style="word-wrap: break-word; margin: 5px 0px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14px;"><div>如果你只想处理一遍，removeStickyBroadcast方法可以帮你，处理完了后就将它删除吧。</div></div></div></div></div></div></span>
</div></body></html> 