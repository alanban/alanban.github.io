<html>
<head>
  <title>URL 和URLConnection 实现网络通信</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303502 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="319"/>
<h1>URL 和URLConnection 实现网络通信</h1>

<div>
<span><div><span style="font-size: 21px;">URL</span></div><div>URL：Uniform(adj 统一的，一致的) Resource Locator（）定位器</div><div>它是指向互联网资源的指针，资源是 简单的文件或者目录，也可以是复杂的引用。</div><div>例如对数据库或者搜索引擎的查询。</div><div>格式：</div><div>          protocol：//host：port/resourcename</div><div>JDK中还提供了一个URI（Uniform Resource Identifies）类 实例代表一个资源标识符</div><div>URL则负责打开一个到达该资源的输入流</div><div><br/></div><div>当使用URL构造器获得指向某个资源的URL对象后</div><div>URL murl =new URL(&quot;139.129.132.218/bansen.jpg&quot;)</div><div><br/></div><div>就可以使用URL的下列常用方法来获取资源</div><ul><li>String getFile()   :  获取此URL指向的资源名</li><li>String getHost() :  获取此URL指向的主机名</li><li>String getPath() :  获取此URL的路径部分</li><li>int      getPort() ： 获取此URL的端口号</li><li>String getProtocol():获取此URL的协议名称</li><li>String getQuery(): 获取URL 的查询字符串部分</li><li>URLConnection openConnection() :返回一个URLConnection对象，它表示URL所引用的远程服务器和本地之间的一个连接。</li><li>InputStream openStream(): 打开与此URL的连接，并返回一个用于读取该URL资源的输入流</li></ul><div><br/></div><div>示例：</div><div style="background-color:#ffffff;color:#000000;font-family:'宋体';font-size:9.0pt;">AppCompatImageView <span style="color:#660e7a;font-weight:bold;">show</span>;<br/>
Bitmap <span style="color:#660e7a;font-weight:bold;">bitmap</span>=<span style="color:#000080;font-weight:bold;">null</span>;<br/><span style="color:#000080;font-weight:bold;">public void </span>Urltest(){<br/>
    <span style="color:#000080;font-weight:bold;">this</span>.<span style="color:#660e7a;font-weight:bold;">show</span>=(AppCompatImageView)findViewById(R.id.<span style="color:#660e7a;font-weight:bold;font-style:italic;">show</span>);<br/>
    <span style="color:#808080;font-style:italic;">//初始化ImageView<br/></span><span style="color:#808080;font-style:italic;"><br/></span><span style="color:#808080;font-style:italic;">   </span> <span style="color:#000080;font-weight:bold;">final </span>android.os.Handler handler =<span style="color:#000080;font-weight:bold;">new </span>Handler(){<br/>
        <span style="color:#808000;">@Override<br/></span><span style="color:#808000;">       </span> <span style="color:#000080;font-weight:bold;">public void </span>handleMessage(Message msg) {<br/>
            <span style="color:#000080;font-weight:bold;">if</span>(msg.<span style="color:#660e7a;font-weight:bold;">what</span>==<span style="color:#0000ff;">666</span>){<br/>
                <span style="color:#660e7a;font-weight:bold;">show</span>.setImageBitmap(<span style="color:#660e7a;font-weight:bold;">bitmap</span>);<br/>
            }<br/>
        }<br/>
    };<br/>
    <span style="color:#000080;font-weight:bold;">new </span>Thread(){<br/>
        <span style="color:#808000;">@Override<br/></span><span style="color:#808000;">       </span> <span style="color:#000080;font-weight:bold;">public void </span>run() {<br/>
            <span style="color:#000080;font-weight:bold;">try </span>{<br/>
                URL murl=<span style="color:#000080;font-weight:bold;">new </span>URL(<span style="color:#008000;font-weight:bold;">&quot;http://139.129.132.218/wp-content/uploads/2015/10/1441078212502.jpg&quot;</span>);<br/>
                InputStream in=murl.openStream();<span style="color:#808080;font-style:italic;">//打开对应的输入流<br/></span><span style="color:#808080;font-style:italic;">               </span> <span style="color:#660e7a;font-weight:bold;">bitmap</span>= BitmapFactory.<span style="font-style:italic;">decodeStream</span>(in);<br/>
                <span style="color:#660e7a;">handler</span>.sendEmptyMessage(<span style="color:#0000ff;">666</span>);<br/>
                in.close();<br/>
            }<span style="color:#000080;font-weight:bold;">catch </span>(Exception e){<br/>
                Snackbar.<span style="font-style:italic;">make</span>(<span style="color:#660e7a;font-weight:bold;">fab</span>,e.toString(),Snackbar.<span style="color:#660e7a;font-weight:bold;font-style:italic;">LENGTH_SHORT</span>).show();<br/>
            }<br/><br/>
        }<br/>
    }.start();</div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;">}</span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;">运行图：</span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><img src="URL 和URLConnection 实现网络通信_files/S51209-203503.jpg" type="image/jpeg" style="cursor: default;"/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><hr/></div><div><span style="font-size: 19px;"><b><span style="font-family: 宋体;">URLConnection</span></b></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div>URL的 openConnection() :返回一个URLConnection对象，URLConnection表示本地程序与远程服务器之间的一个连接。</div><div>程序可以通过URLConnection向目标地址<b>发送请求</b>，然后也可以读取URL引用的资源。</div><div><br/></div><div>使用步骤：</div><ol><li>通过调用URL的openURLConnection()方法来创建URLConnection对象</li><li>设置URLConnection的参数和普通请求属性</li><li>如果只发生GET请求，使用connect方法建立与远程资源之间的实际连接即可；若需发送POST请求，则需要获取URLConnection实例对应的输出流来发送请求参数</li><li>远程资源成为可用的资源，程序可以访问远程资源的头字段，或通过输入流读取远程资源的数据</li></ol><div><br/></div><div>上面的第二部可以使用URLConnection的一下方法来设置</div><ul><li><span style="font-size: 12px;">setAllowUserInteraction():                                    设置allowUserInteraction请求头字段的值</span></li><li><span style="font-size: 12px;">setDoInput() :                                                     设置doIput请求头字段的值</span></li><li><span style="font-size: 12px;">setDoOutput():                                                    </span><span style="font-size: 12px;">设置dooutout请求头字段的值</span></li><li><span style="font-size: 12px;">setifModifiedSince():                                            </span><span style="font-size: 12px;">设置</span><span style="font-size: 12px;">ifModifiedSince</span><span style="font-size: 12px;">请求头字段的值</span></li><li><span style="font-size: 12px;">setUserCaches():                                                  </span><span style="font-size: 12px;">设置</span><span style="font-size: 12px;">UserCaches</span><span style="font-size: 12px;">请求头字段的值</span></li><li><b><span style="font-size: 12px;">setRequestProperty(String key,String value):          </span><span style="font-size: 12px;">设置改URLConnection的key请求头字段的值为 Value 参数的值   </span></b></li></ul><div><b><span style="font-size: 12px;">                                                                                    like： connection.set</span><span style="font-size: 12px;">RequestProperty(”accept“,“*/*”):     这个函数就是因为HTTP请求的头字段需要的头字段的值太多了，然后用这个函数就不用老是调用专门的函数</span></b></div><ul><li><span style="font-size: 12px;">add</span><span style="font-size: 12px;">RequestProperty(String key,String value):         </span><span style="font-size: 12px;">追加</span><span style="font-size: 12px;">URLConnection的key请求头字段的值为 Value 参数的值，不会覆盖之前set的</span></li><li><span style="font-size: 12px;">Object getContent():                                             </span><span style="font-size: 12px;">获取返回的</span><span style="font-size: 12px;">URLConnectiion的内容</span></li><li><span style="font-size: 12px;">String getHeaderField(String name):                      获取指定响应头的值</span></li><li><span style="font-size: 12px;">getInputStream();                                                 <b>返回该</b></span><b><span style="font-size: 12px;">URLConnectiion的输入流 用于获取响应的内容</span></b></li><li><span style="font-size: 12px;">getOutputStream():                                               <b>返回该</b></span><b><span style="font-size: 12px;">URLConnectiion的输出流 用于发送请求参数</span></b></li></ul><div><b><span style="font-size: 12px;"><br/></span></b></div><div><b><span style="font-size: 12px;"><br/></span></b></div><div><b><span style="font-size: 12px;">还有getHeaderField()方法用于根据响应头字段来返回对应的值，而某些头字段需要经常访问</span></b></div><div><b><span style="font-size: 12px;">java还提供了</span></b></div><ul><li><b><span style="font-size: 12px;">getContentEncoding(): 获取content-encoding响应头字段的值</span></b></li><li><b><span style="font-size: 12px;">getContentLength(): 获取conten-length</span></b><b><span style="font-size: 12px;">响应头字段的值</span></b></li><li><b><span style="font-size: 12px;">getContentType（）： 获取content-type</span></b><b><span style="font-size: 12px;">响应头字段的值</span></b></li><li><b><span style="font-size: 12px;">getDate（）：获取date</span></b><b><span style="font-size: 12px;">响应头字段的值</span></b></li><li><span style="font-size: 12px;"><b>getExpirarion（）：获取expires</b></span><b><span style="font-size: 12px;">响应头字段的值</span></b></li><li><b><span style="font-size: 12px;">getLastModified（）：获取last-modified</span></b><b><span style="font-size: 12px;">响应头字段的值</span></b></li></ul><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div><div><span style="font-size: 9pt;"><span style="font-family: 宋体;"><br/></span></span></div></span>
</div></body></html> 