<html>
<head>
  <title>解决ArrayList的ConcurrentModificationException</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303502 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="554"/>
<h1>解决ArrayList的ConcurrentModificationException</h1>

<div>
<span><div style="word-wrap: break-word; color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 14px; font-family: Helvetica, Tahoma, Arial, sans-serif;"><p style="word-wrap: break-word; margin: 5px 0px;"><strong>1 </strong><strong>问题</strong> ：在list&lt;String&gt; 中清空所有的记录，只使用使用单循环，不使用removeAll()</p><p style="word-wrap: break-word; margin: 5px 0px;"> </p><p style="word-wrap: break-word; margin: 5px 0px;"><strong>2 </strong><strong>可以写出五种方式，代码如下：</strong></p><div style="word-wrap: break-word; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; margin-left: 9px; padding: 1px;"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px; margin: 0px; font-weight: bold;">Java代码  <a><img src="解决ArrayList的ConcurrentModificationException_files/Image.png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div></div><ol style="font-size: 1em; color: rgb(43, 145, 175); background-color: rgb(255, 255, 255);"><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">import</span> java.util.ArrayList;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">import</span> java.util.Iterator;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">import</span> java.util.List;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">class</span> ListRemoveTest {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">     <span style="color: rgb(127, 0, 85); font-weight: bold;">public</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">static</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">void</span> main(String[] args) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 ListRemoveTest test = <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> ListRemoveTest();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 System.out.println(<span style="color: blue;">&quot;-1-使用jdk5.0以后的增强for循环去remove&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 List&lt;String&gt; list = test.buildList();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">try</span> {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (String str : list) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                         list.remove(str);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 } <span style="color: rgb(127, 0, 85); font-weight: bold;">catch</span> (Exception e) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(0, 130, 0);">// java.util.ConcurrentModificationException  </span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     e.printStackTrace();     </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 System.out.println(<span style="color: blue;">&quot;-2-使用Iterator的remove&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list = test.buildList();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">try</span> {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     Iterator&lt;String&gt; iterator = list.iterator();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(127, 0, 85); font-weight: bold;">while</span> (iterator.hasNext()) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                         iterator.next();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                         iterator.remove();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 } <span style="color: rgb(127, 0, 85); font-weight: bold;">catch</span> (Exception e) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(0, 130, 0);">// java.lang.IllegalStateException  </span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     e.printStackTrace();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 System.out.println(<span style="color: blue;">&quot;-3-iterator遍历+list的remove&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">try</span> {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     list = test.buildList();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (Iterator&lt;String&gt; iterator = list.iterator(); iterator.hasNext();) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                         String str = (String) iterator.next();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                         list.remove(str);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 } <span style="color: rgb(127, 0, 85); font-weight: bold;">catch</span> (Exception e) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     <span style="color: rgb(0, 130, 0);">// java.util.ConcurrentModificationException  </span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     e.printStackTrace();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 System.out.println(<span style="color: blue;">&quot;-4-使用list的remove(int)方法. [由后向前删除]&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list = test.buildList();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (<span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> i = list.size(); i &gt; <span style="color: rgb(192, 0, 0);">0</span>; i--) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     list.remove(i - <span style="color: rgb(192, 0, 0);">1</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 System.out.println(<span style="color: blue;">&quot;-5-使用list的remove(int)方法. [由前向后删除]&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list = test.buildList();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (<span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> i = <span style="color: rgb(192, 0, 0);">0</span>; i &lt; list.size(); i++) {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                     list.remove(<span style="color: rgb(192, 0, 0);">0</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             <span style="color: rgb(127, 0, 85); font-weight: bold;">private</span> List&lt;String&gt; buildList() {    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 List&lt;String&gt; list = <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> ArrayList&lt;String&gt;();    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list.add(<span style="color: blue;">&quot;a&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list.add(<span style="color: blue;">&quot;b&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 list.add(<span style="color: blue;">&quot;c&quot;</span>);    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                 <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span> list;    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             }    </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><p style="word-wrap: break-word; margin: 5px 0px;"> <strong>3运行结果如下：</strong></p><div style="word-wrap: break-word; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; margin-left: 9px; padding: 1px;"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px; margin: 0px; font-weight: bold;">Xml代码  <a><img src="解决ArrayList的ConcurrentModificationException_files/Image [1].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div></div><ol style="font-size: 1em; color: rgb(43, 145, 175); background-color: rgb(255, 255, 255);"><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">-1-使用jdk5.0以后的增强for循环去remove  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">java.util.ConcurrentModificationException  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">-2-使用Iterator的remove  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">-3-iterator遍历+list的remove  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:781)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at java.util.ArrayList$Itr.next(ArrayList.java:753)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at com.jdk.ListRemoveTest.main(ListRemoveTest.java:14)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">java.util.ConcurrentModificationException  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:781)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at java.util.ArrayList$Itr.next(ArrayList.java:753)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    at com.jdk.ListRemoveTest.main(ListRemoveTest.java:39)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">-4-使用list的remove(int)方法. [由后向前删除]  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">-5-使用list的remove(int)方法. [由前向后删除]  </span></li></ol></div><p style="word-wrap: break-word; margin: 5px 0px;">2，4，5运行正常，1，3抛出</p><p style="word-wrap: break-word; margin: 5px 0px;">java.util.ConcurrentModificationException</p><p style="word-wrap: break-word; margin: 5px 0px;"> </p><p style="word-wrap: break-word; margin: 5px 0px;"><strong>4问题原因：</strong></p><p style="word-wrap: break-word; margin: 5px 0px;">1，3都是因为list的长度改变，Iterator执行next（）方法时，调用checkForComodification（）时出错，1，3是同一个问题，这两个方法remove操作都是执行的是ArrayList中的remove方法，根本原因在于expectedModCount与modCount他们的不相等，由于执行了ArrayList中的remove（），modCount在每一次循环值会发生改变，而expectedModCount并没有发生，在执行checkForComodification（）方法就会抛出异常。</p><p style="word-wrap: break-word; margin: 5px 0px;">2之所以正确运行是因为调用了Iterator的remove方法，4，5不会执行checkForComodification（）操作，所以不会出现这种异常。</p><p style="word-wrap: break-word; margin: 5px 0px;"> </p><p style="word-wrap: break-word; margin: 5px 0px;"><strong>5结论</strong> ：在执行remove（）不要将ArrayList 与Interator混合使用,单独使用Interator以及ArrayList的删除都是OK的<img src="解决ArrayList的ConcurrentModificationException_files/Image.gif" type="image/gif" style="border: 0px;"/></p><p style="word-wrap: break-word; margin: 5px 0px;"><strong>6参考的源码</strong></p><p style="word-wrap: break-word; margin: 5px 0px;">Iterator的next（）方法：</p><div style="word-wrap: break-word; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; margin-left: 9px; padding: 1px;"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px; margin: 0px; font-weight: bold;">Java代码  <a><img src="解决ArrayList的ConcurrentModificationException_files/Image [2].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div></div><ol style="font-size: 1em; color: rgb(43, 145, 175); background-color: rgb(255, 255, 255);"><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span> E next() {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    checkForComodification();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> i = cursor;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (i &gt;= size)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> NoSuchElementException();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    Object[] elementData = ArrayList.<span style="color: rgb(127, 0, 85); font-weight: bold;">this</span>.elementData;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (i &gt;= elementData.length)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> ConcurrentModificationException();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    cursor = i + <span style="color: rgb(192, 0, 0);">1</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span> (E) elementData[lastRet = i];  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">final</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">void</span> checkForComodification() {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (modCount != expectedModCount)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> ConcurrentModificationException();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><p style="word-wrap: break-word; margin: 5px 0px;"> Iterator的remove（）方法：</p><div style="word-wrap: break-word; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; margin-left: 9px; padding: 1px;"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px; margin: 0px; font-weight: bold;">Java代码  <a><img src="解决ArrayList的ConcurrentModificationException_files/Image [3].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div></div><ol style="font-size: 1em; color: rgb(43, 145, 175); background-color: rgb(255, 255, 255);"><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(127, 0, 85); font-weight: bold;">public</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">void</span> remove() {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (lastRet &lt; <span style="color: rgb(192, 0, 0);">0</span>)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> IllegalStateException();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    checkForComodification();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    <span style="color: rgb(127, 0, 85); font-weight: bold;">try</span> {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        ArrayList.<span style="color: rgb(127, 0, 85); font-weight: bold;">this</span>.remove(lastRet);  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        cursor = lastRet;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        lastRet = -<span style="color: rgb(192, 0, 0);">1</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(0, 130, 0);">//当执行remove操作后，将改变的modCount值重新赋给expectedModCount</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">             expectedModCount = modCount;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    } <span style="color: rgb(127, 0, 85); font-weight: bold;">catch</span> (IndexOutOfBoundsException ex) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">        <span style="color: rgb(127, 0, 85); font-weight: bold;">throw</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">new</span> ConcurrentModificationException();  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">    }  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">}  </span></li></ol></div><p style="word-wrap: break-word; margin: 5px 0px;"> ArrayList的remove（）方法：</p><p style="word-wrap: break-word; margin: 5px 0px;"> </p><p style="word-wrap: break-word; margin: 5px 0px;"> </p><div style="word-wrap: break-word; font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; font-size: 12px; margin-left: 9px; padding: 1px;"><div style="word-wrap: break-word;"><div style="word-wrap: break-word; padding: 3px; margin: 0px; font-weight: bold;">Java代码  <a><img src="解决ArrayList的ConcurrentModificationException_files/Image [4].png" type="image/png" alt="收藏代码" style="border: 0px;"/></a></div></div><ol style="font-size: 1em; color: rgb(43, 145, 175); background-color: rgb(255, 255, 255);"><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">/**</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * Removes the first occurrence of the specified element from this list,</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * if it is present.  If the list does not contain the element, it is</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * unchanged.  More formally, removes the element with the lowest index</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * &lt;tt&gt;i&lt;/tt&gt; such that</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * (if such an element exists).  Returns &lt;tt&gt;true&lt;/tt&gt; if this list</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * contained the specified element (or equivalently, if this list</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * changed as a result of the call).</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   *</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * @param o element to be removed from this list, if present</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * @return &lt;tt&gt;true&lt;/tt&gt; if this list contained the specified element</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   */</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">ublic <span style="color: rgb(127, 0, 85); font-weight: bold;">boolean</span> remove(Object o) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (o == <span style="color: rgb(127, 0, 85); font-weight: bold;">null</span>) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">          <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (<span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> index = <span style="color: rgb(192, 0, 0);">0</span>; index &lt; size; index++)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">              <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (elementData[index] == <span style="color: rgb(127, 0, 85); font-weight: bold;">null</span>) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                  fastRemove(index);  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                  <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">true</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">              }  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      } <span style="color: rgb(127, 0, 85); font-weight: bold;">else</span> {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">          <span style="color: rgb(127, 0, 85); font-weight: bold;">for</span> (<span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> index = <span style="color: rgb(192, 0, 0);">0</span>; index &lt; size; index++)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">              <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (o.equals(elementData[index])) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                  fastRemove(index);  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                  <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">true</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">              }  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      }  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(127, 0, 85); font-weight: bold;">return</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">false</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  }  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  <span style="color: rgb(0, 130, 0);">/*</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * Private remove method that skips bounds checking and does not</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   * return the value removed.</span> </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;"><span style="color: rgb(0, 130, 0);">   */</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  <span style="color: rgb(127, 0, 85); font-weight: bold;">private</span> <span style="color: rgb(127, 0, 85); font-weight: bold;">void</span> fastRemove(<span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> index) {  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(0, 130, 0);">//此处modCount发生了改变，但expectedModCount仍然未发生变化，所以再执行下一次循环时执行</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(0, 130, 0);">//Interator的next（）方法当然会报错</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      modCount++;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(127, 0, 85); font-weight: bold;">int</span> numMoved = size - index - <span style="color: rgb(192, 0, 0);">1</span>;  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      <span style="color: rgb(127, 0, 85); font-weight: bold;">if</span> (numMoved &gt; <span style="color: rgb(192, 0, 0);">0</span>)  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">          System.arraycopy(elementData, index+<span style="color: rgb(192, 0, 0);">1</span>, elementData, index,  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">                           numMoved);  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">      elementData[--size] = <span style="color: rgb(127, 0, 85); font-weight: bold;">null</span>; <span style="color: rgb(0, 130, 0);">// Let gc do its work</span>  </span></li><li style="font-size: 1em; background-color: rgb(250, 250, 250);"><span style="color: black;">  }  </span></li></ol></div></div><div style="word-wrap: break-word; color: rgb(0, 0, 0); font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Helvetica, Tahoma, Arial, sans-serif;"><div style="word-wrap: break-word; margin: 5px 0px;"><div><br/></div></div></div></span>
</div></body></html> 